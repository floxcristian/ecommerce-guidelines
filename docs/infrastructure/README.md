# üèóÔ∏è Infrastructure & DevOps - Gu√≠a Completa

Documentaci√≥n especializada para infraestructura moderna, deployment automatizado, observabilidad y escalabilidad enterprise.

## üéØ Objetivos

- üê≥ Containerizaci√≥n completa con Docker
- ‚òÅÔ∏è Deployment escalable en Kubernetes
- üîÑ CI/CD automatizado con GitHub Actions
- üìä Observabilidad y monitoreo completo
- üîê Seguridad y compliance enterprise

## üìö Gu√≠as Especializadas

### üê≥ **Containerizaci√≥n**

- **[Docker Development](./docker-development.md)** - ‚úÖ Entorno local optimizado
- **[Container Optimization](./container-optimization.md)** - üìÑ Multi-stage builds y security

### ‚òÅÔ∏è **Cloud & Orchestration**

- **[Kubernetes Production](./kubernetes-production.md)** - üìÑ GKE y auto-scaling
- **[Helm Charts](./helm-charts.md)** - üìÑ Package management para K8s
- **[Terraform IaC](./terraform-iac.md)** - üìÑ Infrastructure as Code

### üîÑ **CI/CD & Automation**

- **[GitHub Actions Pipelines](./ci-cd-pipelines.md)** - üìÑ Pipelines avanzados
- **[Deployment Strategies](./deployment.md)** - ‚úÖ Blue-Green, Canary, Rolling
- **[GitOps Workflows](./gitops-workflows.md)** - üìÑ Flux y ArgoCD

### üìä **Observability**

- **[Monitoring & Alerting](./observability.md)** - ‚úÖ Prometheus, Grafana, Jaeger
- **[Logging Strategy](./logging-strategy.md)** - üìÑ Loki y agregaci√≥n centralizada
- **[Performance Testing](./performance-testing.md)** - üìÑ Load testing y chaos engineering

### üîê **Security & Compliance**

- **[Security Hardening](./security-hardening.md)** - üìÑ Best practices y compliance
- **[Network Security](./network-security.md)** - üìÑ WAF, DDoS protection, VPN
- **[Secrets Management](./secrets-management.md)** - üìÑ Vault y sealed secrets

## üèóÔ∏è Arquitectura de Infraestructura

### Entornos Multi-Cloud

```mermaid
graph TB
    subgraph "Development - VPS Vultr"
        DEV_LB[Traefik Load Balancer]
        DEV_DOCKER[Docker Compose]
        DEV_DB[(PostgreSQL)]
        DEV_REDIS[(Redis)]
        DEV_CERT[Let's Encrypt]
    end

    subgraph "Production - Google Cloud"
        subgraph "GKE Cluster"
            K8S_LB[Kubernetes LoadBalancer]
            K8S_PODS[Application Pods]
            K8S_PVC[Persistent Volumes]
        end

        subgraph "Managed Services"
            CLOUD_SQL[(Cloud SQL)]
            MEMORYSTORE[(Memorystore Redis)]
            GCS[(Cloud Storage)]
        end

        subgraph "Observability"
            PROMETHEUS[Prometheus]
            GRAFANA[Grafana]
            LOKI[Loki]
            JAEGER[Jaeger]
        end
    end

    subgraph "Edge & CDN"
        CLOUDFLARE[Cloudflare]
        WAF[Web Application Firewall]
        CDN[Content Delivery Network]
    end

    CLOUDFLARE --> DEV_LB
    CLOUDFLARE --> K8S_LB
    WAF --> CLOUDFLARE
    CDN --> CLOUDFLARE

    style DEV_DOCKER fill:#e3f2fd
    style K8S_PODS fill:#e8f5e8
    style PROMETHEUS fill:#fff3e0
    style CLOUDFLARE fill:#f3e5f5
```

## üõ†Ô∏è Stack Tecnol√≥gico

| √Årea                 | Desarrollo (VPS)     | Producci√≥n (GCP)     | Estado |
| -------------------- | -------------------- | -------------------- | ------ |
| **Containerizaci√≥n** | Docker Compose       | Docker + Kubernetes  | ‚úÖ     |
| **Orchestration**    | Traefik              | GKE + Ingress-nginx  | ‚úÖ     |
| **Database**         | PostgreSQL Docker    | Cloud SQL            | ‚úÖ     |
| **Cache**            | Redis Docker         | Memorystore          | ‚úÖ     |
| **Load Balancer**    | Traefik              | GCP Load Balancer    | ‚úÖ     |
| **SSL/TLS**          | Let's Encrypt        | Google-managed SSL   | ‚úÖ     |
| **Monitoring**       | Prometheus + Grafana | GCP Monitoring       | ‚úÖ     |
| **Logging**          | Loki                 | Cloud Logging        | ‚úÖ     |
| **CI/CD**            | GitHub Actions       | GitHub Actions + GKE | ‚úÖ     |
| **IaC**              | Docker configs       | Terraform + Helm     | üìÑ     |

## ‚ö° Quick Start Infrastructure

### üê≥ Desarrollo Local

```bash
# 1. Clonar configuraciones base
git clone <tu-repo> && cd ecommerce-project

# 2. Configurar variables de entorno
cp .env.example .env
# Editar .env con tus configuraciones

# 3. Levantar servicios con Docker Compose
docker-compose up -d

# 4. Verificar servicios
docker-compose ps
curl http://localhost/health

# 5. Ver logs
docker-compose logs -f api-gateway
```

### ‚òÅÔ∏è Producci√≥n GCP

```bash
# 1. Configurar GCP CLI
gcloud auth login
gcloud config set project tu-proyecto-gcp

# 2. Crear cluster GKE
gcloud container clusters create ecommerce-cluster \
  --zone=us-central1-a \
  --num-nodes=3 \
  --enable-autoscaling \
  --min-nodes=1 \
  --max-nodes=10

# 3. Configurar kubectl
gcloud container clusters get-credentials ecommerce-cluster --zone=us-central1-a

# 4. Deploy con Helm
helm upgrade --install ecommerce ./helm-charts/ecommerce \
  --namespace=production \
  --create-namespace \
  --values=values.production.yaml

# 5. Verificar deployment
kubectl get pods -n production
kubectl get services -n production
```

## üéØ Componentes de Infraestructura

### ‚úÖ Docker Development Environment

**Servicios incluidos:**

- [x] API Gateway con Traefik proxy
- [x] Microservicios NestJS containerizados
- [x] PostgreSQL con datos de desarrollo
- [x] Redis para cache y sesiones
- [x] Prometheus + Grafana para monitoreo
- [x] SSL autom√°tico con Let's Encrypt
- [x] Hot-reload para desarrollo
- [x] Networking optimizado entre servicios

### ‚úÖ Kubernetes Production Cluster

**Caracter√≠sticas:**

- [x] Google Kubernetes Engine (GKE)
- [x] Auto-scaling horizontal y vertical
- [x] Persistent volumes para datos
- [x] Ingress controller con SSL/TLS
- [x] Network policies para seguridad
- [x] Resource quotas y limits
- [x] Health checks y readiness probes
- [x] Rolling updates automatizados

### ‚úÖ CI/CD Pipeline

**GitHub Actions workflows:**

- [x] Build y test automatizados
- [x] Docker image building y push
- [x] Security scanning (Snyk, Trivy)
- [x] Deployment automatizado por environment
- [x] Rollback autom√°tico en fallos
- [x] Notificaciones Slack/Discord
- [x] Performance testing en staging
- [x] Blue-Green deployment en producci√≥n

### ‚úÖ Observability Stack

**Componentes:**

- [x] **Prometheus**: M√©tricas de aplicaci√≥n e infraestructura
- [x] **Grafana**: Dashboards y visualizaci√≥n
- [x] **Loki**: Agregaci√≥n de logs
- [x] **Jaeger**: Distributed tracing
- [x] **AlertManager**: Alertas inteligentes
- [x] **Uptime Kuma**: Monitoring de uptime
- [x] **Blackbox Exporter**: Synthetic monitoring

## üìä M√©tricas y SLOs

### üéØ **Service Level Objectives**

| Servicio         | Availability | Latency (p95) | Error Rate | Throughput |
| ---------------- | ------------ | ------------- | ---------- | ---------- |
| **Frontend**     | 99.9%        | < 500ms       | < 0.1%     | > 1000 RPS |
| **API Gateway**  | 99.95%       | < 200ms       | < 0.05%    | > 2000 RPS |
| **Auth Service** | 99.9%        | < 100ms       | < 0.1%     | > 500 RPS  |
| **Orders**       | 99.9%        | < 300ms       | < 0.1%     | > 200 RPS  |
| **Payments**     | 99.95%       | < 1000ms      | < 0.01%    | > 100 RPS  |

### üìà **Infrastructure Metrics**

- **CPU Utilization**: < 70% average, < 90% peak
- **Memory Usage**: < 80% average, < 95% peak
- **Disk I/O**: < 80% utilization
- **Network**: < 70% bandwidth utilization
- **Database Connections**: < 80% of max pool

### üö® **Alerting Rules**

```yaml
# Ejemplo de reglas de alertas
groups:
  - name: ecommerce-alerts
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.01
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High error rate detected"

      - alert: HighLatency
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.5
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High latency detected"
```

## üîÑ Estrategias de Deployment

### üü¶ **Blue-Green Deployment**

**Ventajas:**

- ‚úÖ Zero-downtime deployments
- ‚úÖ Rollback instant√°neo
- ‚úÖ Testing completo en producci√≥n
- ‚úÖ Confianza en releases

**Proceso:**

```bash
# 1. Deploy a environment Green (mientras Blue est√° activo)
helm upgrade ecommerce-green ./charts --values=values.green.yaml

# 2. Verificar health del Green environment
kubectl get pods -l environment=green
curl https://green.api.example.com/health

# 3. Switch traffic de Blue a Green
kubectl patch service ecommerce-lb -p '{"spec":{"selector":{"environment":"green"}}}'

# 4. Monitorear m√©tricas post-deployment
# 5. Si todo OK, destroy Blue environment
```

### üê¶ **Canary Deployment**

**Caracter√≠sticas:**

- üìä Gradual traffic shifting (1% ‚Üí 10% ‚Üí 50% ‚Üí 100%)
- ü§ñ Automatic rollback based on metrics
- üîç A/B testing capabilities
- üìà Risk mitigation for critical services

### üîÑ **Rolling Updates**

**Default para updates menores:**

- üì¶ Pod-by-pod replacement
- üîÑ Continuous availability
- ‚öñÔ∏è Resource efficient
- üéØ Ideal para bug fixes y patches

## üîê Security & Compliance

### üõ°Ô∏è **Security Layers**

```mermaid
graph TB
    subgraph "Edge Security"
        CF[Cloudflare WAF]
        DDOS[DDoS Protection]
        BOT[Bot Management]
    end

    subgraph "Network Security"
        FW[Network Firewall]
        VPC[Private VPC]
        IAM[Identity & Access Management]
    end

    subgraph "Application Security"
        TLS[TLS 1.3 Encryption]
        JWT[JWT Authentication]
        RBAC[Role-Based Access Control]
        INPUT[Input Validation]
    end

    subgraph "Infrastructure Security"
        SCAN[Container Scanning]
        SECRETS[Secrets Management]
        AUDIT[Audit Logging]
        BACKUP[Encrypted Backups]
    end

    CF --> FW
    FW --> TLS
    TLS --> SCAN
```

### üîí **Security Checklist**

- [x] **Container Security**: Multi-stage builds, non-root users, vulnerability scanning
- [x] **Network Security**: Private networks, firewall rules, VPN access
- [x] **Data Security**: Encryption at rest and in transit, backup encryption
- [x] **Access Control**: RBAC, service accounts, least privilege principle
- [x] **Secrets Management**: Encrypted secrets, rotation policies
- [x] **Audit Logging**: Complete audit trail, tamper-proof logs
- [x] **Compliance**: GDPR, SOC2, PCI-DSS considerations

## üîß Herramientas de Desarrollo

### üì¶ **Local Development**

```bash
# Comandos √∫tiles para desarrollo
make dev-start     # Iniciar entorno completo
make dev-stop      # Parar servicios
make dev-logs      # Ver logs agregados
make dev-shell     # Shell en cualquier servicio
make dev-test      # Ejecutar tests
make dev-migrate   # Ejecutar migraciones
```

### üöÄ **Deployment Commands**

```bash
# Deploy a diferentes entornos
make deploy-staging
make deploy-production
make rollback-production

# Monitoreo post-deployment
make health-check
make performance-test
make security-scan
```

### üìä **Monitoring Commands**

```bash
# M√©tricas en tiempo real
kubectl top nodes
kubectl top pods -n production

# Logs agregados
stern -n production api-gateway
kubetail -n production

# Port forwarding para debugging
kubectl port-forward svc/grafana 3000:80
kubectl port-forward svc/prometheus 9090:9090
```

## üìã Checklist de Implementaci√≥n

### ‚úÖ **Desarrollo Local**

- [ ] Docker Compose configurado y funcionando
- [ ] Variables de entorno organizadas
- [ ] SSL/TLS autom√°tico con Traefik
- [ ] Hot-reload configurado para desarrollo
- [ ] Base de datos con data seeding
- [ ] Redis funcionando para cache/sessions
- [ ] Monitoreo b√°sico con Prometheus/Grafana

### ‚úÖ **Staging Environment**

- [ ] Kubernetes cluster configurado
- [ ] Helm charts implementados
- [ ] CI/CD pipeline funcionando
- [ ] Testing automatizado en pipeline
- [ ] Security scanning integrado
- [ ] Performance testing automatizado
- [ ] Rollback autom√°tico configurado

### ‚úÖ **Production Environment**

- [ ] GKE cluster con auto-scaling
- [ ] Managed databases (Cloud SQL)
- [ ] Observabilidad completa implementada
- [ ] Alertas cr√≠ticas configuradas
- [ ] Backup y disaster recovery
- [ ] Security hardening aplicado
- [ ] Documentation operacional completa

## üîó Enlaces R√°pidos

### üõ†Ô∏è **Implementaci√≥n**

- [üê≥ Docker Setup](../../examples/docker-configs/) - Configuraciones Docker listas
- [‚òÅÔ∏è K8s Manifests](../../examples/kubernetes-configs/) - Manifests para GKE
- [üîß Automation Scripts](../../tools/) - Scripts de automatizaci√≥n

### üåê **Otras √Åreas**

- [‚öôÔ∏è Backend Services](../backend/) - Microservicios y APIs
- [üé® Frontend Optimization](../frontend/) - Performance y UX
- [üèõÔ∏è Architecture Decisions](../architecture/) - Decisiones t√©cnicas

### üìö **Documentaci√≥n Externa**

- [Docker Best Practices](https://docs.docker.com/develop/dev-best-practices/)
- [Kubernetes Documentation](https://kubernetes.io/docs/)
- [Google Cloud Documentation](https://cloud.google.com/docs)
- [Helm Charts Guide](https://helm.sh/docs/)

---

## üöÄ **¬øPor d√≥nde empezar?**

### üÜï **Nuevo en containers/K8s**

1. üê≥ Comienza con [Docker Development](./docker-development.md)
2. ‚òÅÔ∏è Aprende [Kubernetes Production](./kubernetes-production.md)
3. üîÑ Implementa [CI/CD Pipelines](./ci-cd-pipelines.md)
4. üìä A√±ade [Observability](./observability.md)

### üöÄ **DevOps experimentado**

1. üìä Revisa [Observability](./observability.md) para stack completo
2. üîê Implementa [Security Hardening](./security-hardening.md)
3. üîÑ Optimiza [Deployment Strategies](./deployment.md)
4. üèóÔ∏è Automatiza con [Terraform IaC](./terraform-iac.md)

### üèõÔ∏è **Platform Engineer**

1. üèóÔ∏è Dise√±a con [Kubernetes Production](./kubernetes-production.md)
2. üîÑ Automatiza con [GitOps Workflows](./gitops-workflows.md)
3. üìä Optimiza con [Performance Testing](./performance-testing.md)
4. üîê Asegura con [Network Security](./network-security.md)

---

**üéØ Pr√≥ximo paso**: Comienza con [Docker Development](./docker-development.md) para configurar tu entorno local, o ve directamente a [Kubernetes Production](./kubernetes-production.md) si ya tienes experiencia con containers.

**üí° Tip**: La infraestructura debe crecer junto con tu aplicaci√≥n. Empieza simple con Docker local y evoluciona hacia Kubernetes seg√∫n tus necesidades de escala.
